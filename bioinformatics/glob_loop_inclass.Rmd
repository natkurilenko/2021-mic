---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.11.3
  kernelspec:
    display_name: Bash
    language: bash
    name: bash
---

```{bash}
source bioinf_config_inclass.sh
mkdir -p $GLOB_TRIM_DIR $GLOB_STAROUT_DIR $GLOB_QC
ls -l $GLOB_OUT_DIR 
echo $GLOB_OUT_DIR
```

```{bash}
grep GLOB bioinf_config_inclass.sh
```

```{bash}
ls -1 $RAW_FASTQ_DIR/*.fastq.gz
```

```{bash}
ls -1 $RAW_FASTQ_DIR/SRR1280447?_2.fastq.gz
```

```{bash}
for FASTQ in $RAW_FASTQ_DIR/SRR1280447?_2.fastq.gz
    do
        echo "RUNNING FASTQ: $FASTQ"
    done    
```

```{bash}
for FASTQ in $RAW_FASTQ_DIR/SRR1280447?_2.fastq.gz
    do
        echo "RUNNING FASTQ: $FASTQ"
    done    
```

```{bash}
echo "$(basename $RAW_FASTQ_DIR/SRR12804472_2.fastq.gz)"
```

```{bash}
echo $(basename $RAW_FASTQ_DIR/SRR12804472_2.fastq.gz "_2.fastq.gz")
```

```{bash}
for FASTQ in $RAW_FASTQ_DIR/SRR1280447?_2.fastq.gz
    do
        echo "RUNNING FASTQ: $FASTQ"
    done    
```

```{bash}
for FASTQ in $RAW_FASTQ_DIR/SRR1280447[23]_2.fastq.gz
    do
        echo "RUNNING FASTQ: $FASTQ"
        SRA_ACCESSION="$(basename $FASTQ '_2.fastq.gz')"
        echo "SRA Number: $SRA_ACCESSION"
    done    
```

```{bash}
for FASTQ in $RAW_FASTQ_DIR/SRR1280447[23]_2.fastq.gz; do
    echo "RUNNING FASTQ: $FASTQ"    
    SRA_ACCESSION="$(basename $FASTQ '_2.fastq.gz')"

    echo "RUNNING FastQC on $RAW_FASTQ_DIR/${SRA_ACCESSION}_1.fastq.gz $RAW_FASTQ_DIR/${SRA_ACCESSION}_2.fastq.gz"
    fastqc --threads $TOTAL_THREADS --extract --outdir $GLOB_QC $RAW_FASTQ_DIR/${SRA_ACCESSION}_1.fastq.gz $RAW_FASTQ_DIR/${SRA_ACCESSION}_2.fastq.gz

    echo "Now Trimming: $SRA_ACCESSION"
    TrimmomaticPE \
        -threads $TOTAL_THREADS \
        -phred33 \
        $RAW_FASTQ_DIR/${SRA_ACCESSION}_1.fastq.gz \
        $RAW_FASTQ_DIR/${SRA_ACCESSION}_2.fastq.gz \
        $GLOB_TRIM_DIR/${SRA_ACCESSION}_1_trimmed.fastq.gz \
        $GLOB_TRIM_DIR/${SRA_ACCESSION}_1_unpaired.fastq.gz \
        $GLOB_TRIM_DIR/${SRA_ACCESSION}_2_trimmed.fastq.gz \
        $GLOB_TRIM_DIR/${SRA_ACCESSION}_2_unpaired.fastq.gz \
        ILLUMINACLIP:TruSeq2-PE.fa:2:30:10:2:keepBothReads SLIDINGWINDOW:4:15 LEADING:3 TRAILING:3 MINLEN:36 
    
    echo "Now Mapping: $SRA_ACCESSION"

    STAR \
        --runMode alignReads \
        --twopassMode None \
        --genomeDir $GENOME_DIR \
        --readFilesCommand gunzip -c \
        --readFilesIn $GLOB_TRIM_DIR/${SRA_ACCESSION}_1_trimmed.fastq.gz $GLOB_TRIM_DIR/${SRA_ACCESSION}_2_trimmed.fastq.gz \
        --outFileNamePrefix ${GLOB_STAROUT_DIR}/${SRA_ACCESSION}_ \
        --quantMode GeneCounts \
        --outSAMtype None \
        --runThreadN $TOTAL_THREADS
done
```

```{bash}
multiqc $GLOB_QC --outdir $GLOB_QC
```

```{bash}
ls ${GLOB_OUT_DIR}/*
```

```{bash}
# If running all of the FASTQs in a directory, could break
#fastqc --threads $TOTAL_THREADS --extract --outdir $GLOB_QC $RAW_FASTQ_DIR/*.fastq.gz

```
