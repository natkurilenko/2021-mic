---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.11.3
  kernelspec:
    display_name: Bash
    language: bash
    name: bash
---

# Making a Pipeline
Combining cells can make things easier

## Shell Variables
Assign the variables in this notebook.

```{bash}
source bioinf_config.sh
mkdir -p $PIPE_TRIM_DIR $PIPE_STAROUT_DIR
```

## Combining the Steps

```{bash}
SRA_ACCESSION="SRR12804466"
echo "---------------- TRIMMING: $SRA_ACCESSION ----------------"
TrimmomaticPE \
    -threads $TOTAL_THREADS \
    -phred33 \
    ${RAW_FASTQ_DIR}/${SRA_ACCESSION}_1.fastq.gz \
    ${RAW_FASTQ_DIR}/${SRA_ACCESSION}_2.fastq.gz \
    ${PIPE_TRIM_DIR}/${SRA_ACCESSION}_1_trimmed.fastq.gz \
    ${PIPE_TRIM_DIR}/${SRA_ACCESSION}_1_unpaired.fastq.gz \
    ${PIPE_TRIM_DIR}/${SRA_ACCESSION}_2_trimmed.fastq.gz \
    ${PIPE_TRIM_DIR}/${SRA_ACCESSION}_2_unpaired.fastq.gz \
    ILLUMINACLIP:TruSeq2-PE.fa:2:30:10:2:keepBothReads LEADING:3 TRAILING:3 MINLEN:36

echo "---------------- MAPPING: $SRA_ACCESSION ----------------"
STAR \
    --runMode alignReads \
    --twopassMode None \
    --genomeDir $GENOME_DIR \
    --readFilesIn ${PIPE_TRIM_DIR}/${SRA_ACCESSION}_1_trimmed.fastq.gz ${PIPE_TRIM_DIR}/${SRA_ACCESSION}_2_trimmed.fastq.gz \
    --readFilesCommand gunzip -c \
    --outFileNamePrefix ${PIPE_STAROUT_DIR}/${SRA_ACCESSION}_ \
    --quantMode GeneCounts \
    --outSAMtype None \
    --runThreadN $TOTAL_THREADS
```

### And let's check the result

```{bash}
ls ${PIPE_STAROUT_DIR}
```
