---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.11.3
  kernelspec:
    display_name: Bash
    language: bash
    name: bash
---

# Working with Loops
Let's kick it up another notch we have lots of FASTQs, let's run our analysis on more than one!

Load variables from bioinf_config.sh, make a new directory for output, and check that it looks OK.

```{bash}
source bioinf_config.sh
mkdir -p $MULTI_TRIM_DIR $MULTI_STAROUT_DIR
```

## First our toy example

```{bash}
for SRA_ACCESSION in SRR12804466 SRR12804465
    do
        echo "RUNNING SRA_ACCESSION: ${SRA_ACCESSION}"
    done
```

## Now let's run both samples throught the pipeline:

```{bash}
for SRA_ACCESSION in "SRR12804466" "SRR12804465" ; do
    echo "---------------- TRIMMING: $SRA_ACCESSION ----------------"
    TrimmomaticPE \
        -threads $TOTAL_THREADS \
        -phred33 \
        ${RAW_FASTQ_DIR}/${SRA_ACCESSION}_1.fastq.gz \
        ${RAW_FASTQ_DIR}/${SRA_ACCESSION}_2.fastq.gz \
        ${MULTI_TRIM_DIR}/${SRA_ACCESSION}_1_trimmed.fastq.gz \
        ${MULTI_TRIM_DIR}/${SRA_ACCESSION}_1_unpaired.fastq.gz \
        ${MULTI_TRIM_DIR}/${SRA_ACCESSION}_2_trimmed.fastq.gz \
        ${MULTI_TRIM_DIR}/${SRA_ACCESSION}_2_unpaired.fastq.gz \
        ILLUMINACLIP:TruSeq2-PE.fa:2:30:10:2:keepBothReads LEADING:3 TRAILING:3 MINLEN:36

    echo "---------------- MAPPING: $SRA_ACCESSION ----------------"
    STAR \
        --runMode alignReads \
        --twopassMode None \
        --genomeDir $GENOME_DIR \
        --readFilesIn ${MULTI_TRIM_DIR}/${SRA_ACCESSION}_1_trimmed.fastq.gz ${MULTI_TRIM_DIR}/${SRA_ACCESSION}_2_trimmed.fastq.gz \
        --readFilesCommand gunzip -c \
        --outFileNamePrefix ${MULTI_STAROUT_DIR}/${SRA_ACCESSION}_ \
        --quantMode GeneCounts \
        --outSAMtype None \
        --runThreadN $TOTAL_THREADS
done
```

### And let's check the result

```{bash}
ls $MULTI_STAROUT_DIR
```
